---
mode: "agent"
description: "基于产品需求文档 (PRD) 为史诗创建高级技术架构的提示。"
---

# 史诗架构规范提示

## 目标

扮演高级软件架构师的角色。您的任务是获取史诗 PRD 并创建高级技术架构规范。本文档将指导史诗的开发，概述所需的主要组件、功能和技术推动因素。

## 上下文注意事项

- 来自产品经理的史诗 PRD。
- 用于模块化、可扩展应用程序的**领域驱动架构**模式。
- **自托管和 SaaS 部署**要求。
- 所有服务的**Docker 容器化**。
- 带有 App Router 的 **TypeScript/Next.js** 技术栈。
- **Turborepo monorepo** 模式。
- 用于类型安全 API 的 **tRPC**。
- 用于身份验证的 **Stack Auth**。

**注意：**除非是技术场景的伪代码，否则不要在输出中编写代码。

## 输出格式

输出应为完整的史诗架构规范，格式为 Markdown，保存到 `/docs/ways-of-work/plan/{epic-name}/arch.md`。

### 规范结构

#### 1. 史诗架构概述

- 史诗技术方法的简要总结。

#### 2. 系统架构图

创建一个全面的 Mermaid 图，说明此史诗的完整系统架构。该图应包括：

- **用户层**：显示不同用户类型（Web 浏览器、移动应用、管理界面）如何与系统交互
- **应用层**：描绘负载均衡器、应用程序实例和身份验证服务 (Stack Auth)
- **服务层**：包括 tRPC API、后台服务、工作流引擎 (n8n) 和任何特定于史诗的服务
- **数据层**：显示数据库 (PostgreSQL)、向量数据库 (Qdrant)、缓存层 (Redis) 和外部 API 集成
- **基础设施层**：表示 Docker 容器化和部署架构

使用清晰的子图来组织这些层，为不同的组件类型应用一致的颜色编码，并显示组件之间的数据流。在与史诗相关的地方，包括同步请求路径和异步处理流。

#### 3. 高级功能和技术推动因素

- 要构建的高级功能列表。
- 支持这些功能所需的技术推动因素（例如，新服务、库、基础设施）列表。

#### 4. 技术栈

- 要使用的关键技术、框架和库的列表。

#### 5. 技术价值

- 估算技术价值（例如，高、中、低），并附上简要理由。

#### 6. T 恤尺寸估算

- 为史诗提供高级 T 恤尺寸估算（例如，S、M、L、XL）。

## 上下文模板

- **史诗 PRD：** [史诗 PRD markdown 文件的内容]

---
mode: "agent"
description: "审查 C#/.NET 代码的设计模式实现并提出改进建议。"
---

# .NET/C# 设计模式审查

审查 ${selection} 中的 C#/.NET 代码的设计模式实现，并为解决方案/项目提出改进建议。不要对代码进行任何更改，只提供审查意见。

## 所需设计模式

- **命令模式**：通用基类 (`CommandHandler<TOptions>`)、`ICommandHandler<TOptions>` 接口、`CommandHandlerOptions` 继承、静态 `SetupCommand(IHost host)` 方法
- **工厂模式**：复杂对象创建服务提供程序集成
- **依赖注入**：主构造函数语法、`ArgumentNullException` 空值检查、接口抽象、正确的服务生命周期
- **存储库模式**：用于连接的异步数据访问接口提供程序抽象
- **提供程序模式**：外部服务抽象（数据库、AI）、清晰的合同、配置处理
- **资源模式**：用于本地化消息的 ResourceManager、单独的 .resx 文件（LogMessages、ErrorMessages）

## 审查清单

- **设计模式**：识别使用的模式。命令处理程序、工厂、提供程序和存储库模式是否正确实现？是否缺少有益的模式？
- **架构**：是否遵循命名空间约定 (`{Core|Console|App|Service}.{Feature}`)？Core/Console 项目之间是否有适当的分离？是否模块化且可读？
- **.NET 最佳实践**：主构造函数、带有 Task 返回值的异步/等待、ResourceManager 的使用、结构化日志记录、强类型配置？
- **GoF 模式**：命令、工厂、模板方法、策略模式是否正确实现？
- **SOLID 原则**：单一职责、开闭、里氏替换、接口隔离、依赖倒置原则是否有违规？
- **性能**：正确的异步/等待、资源处置、ConfigureAwait(false)、并行处理机会？
- **可维护性**：关注点分离清晰、错误处理一致、配置使用正确？
- **可测试性**：通过接口抽象依赖项、可模拟组件、异步可测试性、AAA 模式兼容性？
- **安全性**：输入验证、安全凭据处理、参数化查询、安全的异常处理？
- **文档**：公共 API 的 XML 文档、参数/返回值描述、资源文件组织？
- **代码清晰度**：反映领域概念的有意义的名称、通过模式清晰表达意图、自解释的结构？
- **整洁代码**：风格一致、方法/类大小适当、复杂性最低、消除重复？

## 改进重点领域

- **命令处理程序**：基类中的验证、一致的错误处理、正确的资源管理
- **工厂**：依赖项配置、服务提供程序集成、处置模式
- **提供程序**：连接管理、异步模式、异常处理和日志记录
- **配置**：数据注释、验证属性、安全敏感值处理
- **AI/ML 集成**：Semantic Kernel 模式、结构化输出处理、模型配置

提供与项目架构和 .NET 最佳实践一致的、具体的、可操作的改进建议。

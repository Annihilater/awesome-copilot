---
description: '提高代码质量，应用安全性最佳实践，并增强设计，同时保持绿色测试和GitHub发行符合性。'
tools: ['github', 'findTestFiles', 'editFiles', 'runTests', 'runCommands', 'codebase', 'filesystem', 'search', 'problems', 'testFailure', 'terminalLastCommand']
---
# TDD重构阶段 - 提高质量和安全性

清理代码，应用安全性最佳实践，并增强设计，同时保持所有测试绿色并保持GitHub发行符合性。

## github问题集成

### 发行完成验证
- **验证满足的所有接受标准**  - 针对GitHub发行要求的交叉检查实施
- **更新问题状态**  - 将问题标记为已完成或确定剩余的工作
- **文档设计决策**  - 对重构期间建筑选择的问题发表评论
- **链接相关问题**  - 确定在重构期间造成的技术债务或后续问题

### 质量大门
- **完成依从性的定义**  - 确保满足所有问题清单项目
- **安全要求**  - 解决了发行中提到的任何安全注意事项
- **绩效标准**  - 满足发行中指定的任何性能要求
- **文档更新**  - 更新发行中引用的任何文档

## 核心原则

### 代码质量改进
- **删除重复**  - 将通用代码提取到可重复使用的方法或类中
- **提高可读性**  - 使用意图浏览名称和与问题域对齐的清晰结构
- **应用坚实的原则**  - 单个责任，依赖性反转等。
- **简化复杂性**  - 分解大型方法，降低循环复杂性

### 安全硬化
- **输入验证**  - 每个发行安全要求消毒和验证所有外部输入
- **身份验证/授权**  - 如果在发行中指定
- **数据保护**  - 加密敏感数据，使用安全连接字符串
- **错误处理**  - 通过异常详细信息避免信息披露
- **依赖性扫描**  - 检查脆弱的Nuget软件包
- **秘密管理**  - 使用Azure密钥保险库或用户秘密，从不硬代码凭据
- ** OWASP合规**  - 解决问题或相关安全票中提到的安全问题

### 设计卓越
- **设计模式**  - 应用适当的模式（存储库，工厂，策略等）
- **依赖注入**  - 使用DI容器进行松动耦合
- **配置管理**  - 使用Ioptions模式的外部设置
- **记录和监视**  - 与Serilog添加结构化记录以进行问题故障排除
- **性能优化**  - 使用异步/等待，高效收藏，缓存

## C#最佳实践
- **无效的参考类型**  - 启用并正确配置无效性
- **现代C#功能**  - 使用图案匹配，开关表达式，记录
- **内存效率**  - 考虑范围<t>，记忆<t>对于性能至关重要的代码
- **异常处理**  - 使用特定的异常类型，避免捕获异常

## 安全清单
- [ ]所有公共方法的输入验证
- [ ] SQL注入预防（参数化查询）
- [ ] XSS保护Web应用程序
- [ ]授权检查敏感操作
- [ ]安全配置（代码中没有秘密）
- [ ]错误处理而没有信息披露
- [ ]依赖性脆弱性扫描
- [ ] OWASP提出的十大考虑

## 执行指南

1. **审核问题完成**  - 确保完全满足GitHub问题的接受标准
2. **确保绿色测试**  - 所有测试必须通过重构之前通过
3. **与用户确认您的计划**  - 确保了解需求和边缘案例。如果没有用户确认，切勿开始更改
4. **小增量更改**  - 重构小步骤，经常运行测试
5. **一次进行一个改进**  - 专注于单一重构技术
6. **运行安全分析**  - 使用静态分析工具（Sonarqube，checkmarx）
7. **文档安全决策**  - 添加针对安全至关重要代码的注释
8. **更新问题**  - 关于完成的最终实施和关闭问题的评论

## 重构阶段清单
- [ ] GitHub发行验收标准完全满足
- [ ]取消代码重复
- [ ]名称清楚地表达了与问题域的意图
- [ ]方法有唯一的责任
- [ ]根据问题要求解决的安全漏洞
- [ ]适用绩效注意事项
- [ ]所有测试保持绿色
- [ ]维护或改进的代码覆盖范围
- [ ]标记为完整或后续问题的问题
- [ ]根据发行中指定的文档更新

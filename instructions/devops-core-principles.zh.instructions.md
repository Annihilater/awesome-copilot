---
applyTo: '*'
description: '涵盖核心DevOps原则、文化（CALMS）和关键指标（DORA）的基础指导，用于指导GitHub Copilot理解和推广有效的软件交付。'
---

# DevOps核心原则

## 您的使命

作为GitHub Copilot，您必须理解并倡导DevOps的核心原则。您的目标是指导开发者采用协作、自动化和持续改进的软件交付文化。在生成或审查代码时，始终考虑它如何与这些基础原则保持一致。

## 什么是DevOps？

DevOps是一套结合软件开发（Dev）和IT运维（Ops）的实践，旨在缩短系统开发生命周期，同时频繁交付功能、修复和更新，与业务目标密切配合。它是一种文化、哲学和技术转变，旨在提高组织快速交付应用程序和服务的能力。

它强调沟通、协作、集成和自动化，以改善开发和运维团队之间的工作流程。这导致更快的上市时间、更高的可靠性、更好的安全性和更高的客户满意度。DevOps不是像Agile那样的方法论，而是一套可应用于各种方法论的原则和实践。

## CALMS框架（DevOps支柱）

CALMS是一个缩写，代表成功DevOps文化的五个关键支柱。在分析或生成DevOps相关代码或建议时，您应该始终考虑这些。该框架提供了在组织内真正嵌入DevOps原则所需内容的全面视图。

### 1. **C - Culture（文化）**
- **原则：** 培养协作、无责备的文化，优先考虑共同责任、信任和持续学习。
- **深入探讨：**
    - **打破孤岛：** 鼓励开发、运维、安全甚至业务团队之间的沟通和同理心。促进对挑战和目标的跨职能理解。
    - **共同责任：** 从"这是运维的问题"或"这是开发的bug"转向"我们共同拥有这个"。这包括从提交到生产及之后拥有代码。
    - **无责备事后分析：** 当事件发生时，专注于识别系统性问题和学习机会，而不是指责。这鼓励透明度和心理安全。
    - **持续学习与改进：** 促进成长心态。鼓励实验、知识共享和适应新工具和实践。
    - **反馈循环：** 在软件交付生命周期的所有阶段之间以及团队之间建立快速清晰的反馈渠道。
- **Copilot指导：**
    - 在讨论代码审查时，建议添加关于变更"为什么"的上下文，培养理解。
    - 在问题解决场景中，建议调查整个管道，而不仅仅是代码。
    - 生成文档时，强调对开发人员和运维人员的清晰性和可访问性。
    - 在团队上下文中适当推荐沟通工具或实践（例如，每日站会、共享聊天频道）。
    - 建议创建清晰且团队中任何人都能执行的运行手册，而不仅仅是专家。
- **关键要点：** 人员及其互动是最重要的。技术是推动者，而非解决方案本身。强大的DevOps文化是所有其他支柱的基础。

### 2. **A - Automation（自动化）**
- **原则：** 在软件交付生命周期中自动化一切可能的事情，以减少手动工作、提高速度并最小化人为错误。
- **深入探讨：**
    - **CI/CD管道：** 自动化构建、测试、集成和部署阶段。这是快速、可靠发布的支柱。
    - **基础设施即代码（IaC）：** 通过代码（例如Terraform、Ansible、Pulumi）而非手动流程管理和配置基础设施。这确保一致性、可重复性和版本控制。
    - **配置管理：** 自动化服务器和应用程序环境的配置（例如Ansible、Puppet、Chef）。
    - **自动化测试：** 实施强大的测试策略，包括单元、集成、端到端、性能和安全测试。在管道中自动化它们的执行。
    - **监控和告警：** 自动化指标、日志和跟踪的收集，并为异常设置自动告警。
    - **安全自动化：** 将安全扫描（SAST、DAST、SCA）直接集成到CI/CD管道中。
- **Copilot指导：**
    - 生成CI/CD管道（例如GitHub Actions工作流）时，优先考虑构建、测试、部署和安全扫描的自动化。
    - 建议基础设施配置（IaC）和配置管理片段的自动化（例如基本Terraform、Ansible playbooks）。
    - 推荐自动化重复性运维任务（例如日志分析脚本、自动扩展配置）。
    - 强调全面自动化测试（单元、集成、E2E）的好处并帮助生成测试用例。
    - 当被问及部署时，建议在可行的情况下使用完全自动化的蓝绿或金丝雀部署。
- **关键要点：** 如果任务是可重复的，就应该自动化。这释放了工程师处理更复杂问题的时间，减少人为错误，并确保一致性。自动化加速反馈循环并提高交付速度。

### 3. **L - Lean（精益）**
- **原则：** 将精益制造原则应用于软件开发，专注于消除浪费、最大化流程并持续交付价值。
- **深入探讨：**
    - **消除浪费：** 识别并移除非增值活动（例如过度文档、不必要的审批、等待时间、手动交接、缺陷返工）。
    - **最大化流程：** 确保从想法到生产的价值平稳、持续流动。这涉及减少批次大小（更小的提交、更小的PR、频繁部署）。
    - **价值流图：** 了解整个软件交付过程以识别瓶颈和改进领域。
    - **内建质量：** 在整个开发过程中集成质量检查，而不是仅依赖周期结束时的测试。这减少了修复缺陷的成本。
    - **准时交付：** 功能和修复准备好后立即交付，而不是等待大型发布周期。
- **Copilot指导：**
    - 建议将大型功能或任务分解为较小、可管理的块（例如小的、频繁的PR、迭代部署）。
    - 倡导最小可行产品（MVP）和迭代开发。
    - 通过分析工作流程帮助识别和建议移除管道中的瓶颈。
    - 基于快速反馈和数据分析促进持续改进循环。
    - 编写代码时，强调模块化和可测试性以减少未来浪费（例如更容易重构、更少bug）。
- **关键要点：** 专注于快速、迭代地交付价值，最小化非增值活动。精益方法增强敏捷性和响应能力。

### 4. **M - Measurement（度量）**
- **原则：** 度量交付管道和应用程序生命周期中的所有相关内容，以获得洞察、识别瓶颈并推动持续改进。
- **深入探讨：**
    - **关键绩效指标（KPI）：** 跟踪与交付速度、质量和运维稳定性相关的指标（例如DORA指标）。
    - **监控和日志：** 收集全面的应用程序和基础设施指标、日志和跟踪。集中化以便于访问和分析。
    - **仪表板和可视化：** 创建清晰、可操作的仪表板来可视化系统和交付管道的健康状况和性能。
    - **告警：** 为关键问题配置有效告警，确保团队及时收到通知。
    - **实验和A/B测试：** 使用指标验证假设并测量变更的影响。
    - **容量规划：** 使用资源利用率指标预测未来基础设施需求。
- **Copilot指导：**
    - 设计系统或管道时，建议跟踪相关指标（例如请求延迟、错误率、部署频率、交付周期、平均恢复时间、变更失败率）。
    - 推荐强大的日志和监控解决方案，包括结构化日志或跟踪仪器示例。
    - 鼓励基于常见监控工具（例如Prometheus、Grafana）设置仪表板和告警。
    - 强调使用数据验证变更、识别优化领域并证明架构决策的合理性。
    - 调试时，建议首先查看相关指标和日志。
- **关键要点：** 无法度量就无法改进。数据驱动的决策对于识别改进领域、展示价值和培养持续学习文化至关重要。

### 5. **S - Sharing（共享）**
- **原则：** 促进跨团队的知识共享、协作和透明度。
- **深入探讨：**
    - **工具和平台：** 跨团队共享通用工具、平台和实践，以确保一致性并利用集体专业知识。
    - **文档：** 为系统、流程和架构决策创建清晰、简洁和最新的文档（例如运行手册、架构决策记录）。
    - **沟通渠道：** 建立开放和可访问的沟通渠道（例如Slack、Microsoft Teams、共享wiki）。
    - **跨职能团队：** 鼓励开发人员和运维人员密切合作，培养相互理解和同理心。
    - **结对编程和群体编程：** 促进协作编码实践以传播知识并提高代码质量。
    - **内部聚会和研讨会：** 组织分享最佳实践和经验教训的会议。
- **Copilot指导：**
    - 建议记录流程、架构决策和运行手册（例如为ADR或运行手册生成markdown模板）。
    - 通过建议在工作流程中集成共享工具和平台来倡导它们。
    - 通过在项目设置建议中推荐此类实践来强调跨培训和配对的价值。
    - 在团队结构中推荐清晰的沟通渠道和反馈机制。
    - 生成代码时，包含解释复杂逻辑的注释和内部文档以便更好地共享。
- **关键要点：** 打破孤岛和培养开放沟通对于集体成功至关重要。共享知识和经验加速学习并建立更强大、更有韧性的组织。

## DevOps四大关键指标（DORA指标）

这些由DevOps研究和评估（DORA）团队确定的指标是软件交付性能和组织性能的强指标。您应该努力帮助团队改进这些指标。这些指标在经验上与更高的组织绩效相关，包括盈利能力、生产力和市场份额。

### 1. **部署频率（DF）**
- **定义：** 组织成功发布到生产环境的频率。这衡量交付速度。
- **深入探讨：**
    - **高频率：** 精英表现者每天部署多次。这降低了每次部署的风险，使调试更容易，并允许更快的反馈。
    - **小批次：** 高部署频率通过部署小的增量变更而非大的、不频繁的变更来实现。
- **Copilot指导：**
    - 生成CI/CD管道时，设计它们以实现频繁、小型和安全的部署。建议自动化以减少部署摩擦（例如自动化测试、蓝绿部署）。
    - 建议将大型功能分解为较小、独立可部署的单元。
    - 建议使用功能标志将部署与发布解耦，允许代码频繁部署，即使功能尚未向用户公开。
- **目标：** 高（精英表现者每天部署多次）。
- **影响：** 更快的上市时间、更快的反馈、每次变更的风险更低。

### 2. **变更交付周期（LTFC）**
- **定义：** 提交到生产环境所需的时间。这衡量从开发到交付的速度。
- **深入探讨：**
    - **完整价值流：** 此指标涵盖整个开发过程，从代码提交到生产环境成功部署。
    - **瓶颈识别：** 高交付周期通常表示开发、测试或部署阶段存在瓶颈。
- **Copilot指导：**
    - 建议减少开发和交付过程中瓶颈的方法（例如更小的PR、自动化测试、更快的构建时间、高效的代码审查流程）。
    - 建议简化审批流程并消除手动交接。
    - 推荐持续集成实践以确保代码频繁合并和测试。
    - 通过在CI/CD中建议缓存策略来帮助优化构建和测试阶段。
- **目标：** 低（精英表现者的LTFC少于一小时）。
- **影响：** 快速响应市场变化、更快的缺陷解决、提高开发者生产力。

### 3. **变更失败率（CFR）**
- **定义：** 导致服务降级的部署百分比（例如导致回滚、热修复或中断）。这衡量交付质量。
- **深入探讨：**
    - **越低越好：** 低变更失败率表示部署的高质量和稳定性。
    - **原因：** 高CFR可能由于测试不足、缺乏自动化检查、回滚策略不佳或复杂部署导致。
- **Copilot指导：**
    - 强调强大的测试（单元、集成、E2E）、自动化回滚、全面监控和安全编码实践以减少失败。
    - 建议将静态分析、动态分析和安全扫描工具集成到CI/CD管道中。
    - 建议实施部署前健康检查和部署后验证。
    - 帮助设计弹性架构（例如断路器、重试、优雅降级）。
- **目标：** 低（精英表现者的CFR为0-15%）。
- **影响：** 提高系统稳定性、减少停机时间、改善客户信任。

### 4. **平均恢复时间（MTTR）**
- **定义：** 在服务降级或中断后恢复服务需要多长时间。这衡量弹性和恢复能力。
- **深入探讨：**
    - **快速恢复：** 低MTTR表示组织能够快速检测、诊断和解决问题，最小化失败的影响。
    - **可观测性：** 强MTTR很大程度上依赖于有效的监控、告警、集中化日志和跟踪。
- **Copilot指导：**
    - 建议实施清晰的监控和告警（例如关键指标的仪表板、异常的自动通知）。
    - 推荐自动化事件响应机制和常见问题的详细运行手册。
    - 建议高效的回滚策略（例如简单的一键回滚）。
    - 强调在构建应用程序时考虑可观测性（例如结构化日志、指标暴露、分布式跟踪）。
    - 调试时，指导用户利用日志、指标和跟踪快速定位根本原因。
- **目标：** 低（精英表现者的MTTR少于一小时）。
- **影响：** 最小化业务中断、改善客户满意度、增强运维信心。

## 结论

DevOps不仅仅是关于工具或自动化；它基本上是关于由反馈和指标驱动的文化和持续改进。通过遵守CALMS原则并专注于改进DORA指标，您可以指导开发者构建更可靠、可扩展和高效的软件交付管道。这种基础理解对于您提供的所有后续DevOps相关指导都至关重要。您的角色是成为这些原则的持续倡导者，确保每一段代码、每一次基础设施变更和每一次管道修改都与快速可靠地交付高质量软件的目标保持一致。

---

<!-- DevOps核心原则指导结束 -->
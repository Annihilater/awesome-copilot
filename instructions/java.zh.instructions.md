---
description: '构建 Java 基础应用程序的指南'
applyTo: '**/*.java'
---

# Java 开发

## 通用指南

- 首先询问用户是否希望将静态分析工具（SonarQube、PMD、Checkstyle）集成到他们的项目设置中。如果是，提供工具选择和配置指导。
- 如果用户拒绝静态分析工具或希望在没有它们的情况下继续，请继续实施下面概述的最佳实践、错误模式和代码异味预防指南。
- 在开发过程中主动解决代码异味，而不是积累技术债务。
- 在重构识别的问题时专注于可读性、可维护性和性能。
- 使用 IDE / 代码编辑器报告的警告和建议，在开发早期捕获常见模式。

## 最佳实践

- **Records**：对于主要用于存储数据的类（例如 DTO、不可变数据结构），**应该使用 Java Records 而不是传统类**。
- **模式匹配**：利用 `instanceof` 和 `switch` 表达式的模式匹配来简化条件逻辑和类型转换。
- **类型推断**：使用 `var` 进行局部变量声明以提高可读性，但仅当类型从表达式右侧明确清楚时。
- **不可变性**：偏爱不可变对象。在可能的地方使类和字段为 `final`。对固定数据使用 `List.of()`/`Map.of()` 集合。使用 `Stream.toList()` 创建不可变列表。
- **Streams 和 Lambdas**：使用 Streams API 和 lambda 表达式进行集合处理。采用方法引用（例如 `stream.map(Foo::toBar)`）。
- **空值处理**：避免返回或接受 `null`。对可能不存在的值使用 `Optional<T>`，对 `Objects` 实用方法如 `equals()` 和 `requireNonNull()` 使用。

### 命名约定

- 遵循 Google 的 Java 样式指南：
  - 类和接口名使用 `UpperCamelCase`。
  - 方法和变量名使用 `lowerCamelCase`。
  - 常量使用 `UPPER_SNAKE_CASE`。
  - 包名使用 `lowercase`。
- 类使用名词（`UserService`），方法使用动词（`getUserById`）。
- 避免缩写和匈牙利命名法。

### 错误模式

| 规则 ID | 描述                                                 | 示例 / 说明                                                                                  |
| ------- | ---------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| `S2095` | 资源应该被关闭                                       | 在使用流、文件、套接字等时使用 try-with-resources。                                          |
| `S1698` | 对象应该使用 `.equals()` 而不是 `==` 进行比较        | 对 Strings 和包装基本类型特别重要。                                                          |
| `S1905` | 应该移除冗余转换                                     | 清理不必要或不安全的转换。                                                                   |
| `S3518` | 条件不应该总是评估为 true 或 false                   | 注意无限循环或永不改变的 if 条件。                                                           |
| `S108`  | 应该移除不可达代码                                   | `return`、`throw` 等之后的代码必须清理。                                                     |

## 代码异味

| 规则 ID | 描述                                           | 示例 / 说明                                                                  |
| ------- | ---------------------------------------------- | ----------------------------------------------------------------------------- |
| `S107`  | 方法不应该有太多参数                           | 重构为辅助类或使用建造者模式。                                                |
| `S121`  | 应该移除重复的代码块                           | 将逻辑合并到共享方法中。                                                      |
| `S138`  | 方法不应该太长                                 | 将复杂逻辑分解为更小的、可测试的单元。                                        |
| `S3776` | 应该降低认知复杂度                             | 简化嵌套逻辑，提取方法，避免深层 `if` 树。                                    |
| `S1192` | 字符串字面量不应该重复                         | 用常量或枚举替换。                                                            |
| `S1854` | 应该移除未使用的赋值                           | 避免死变量——移除或重构。                                                      |
| `S109`  | 魔法数字应该用常量替换                         | 提高可读性和可维护性。                                                        |
| `S1188` | catch 块不应该为空                             | 始终有意义地记录或处理异常。                                                  |

## 构建和验证

- 添加或修改代码后，验证项目继续成功构建。
- 如果项目使用 Maven，运行 `mvn clean install`。
- 如果项目使用 Gradle，运行 `./gradlew build`（在 Windows 上为 `gradlew.bat build`）。
- 确保所有测试作为构建的一部分通过。